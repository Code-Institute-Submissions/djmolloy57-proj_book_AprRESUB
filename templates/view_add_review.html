{% extends "base.html" %}

{% block content %}
<h4>View and Add Review</h4>




<table cellspacing="0" class="column-options">
    <th>Book Name</th>
    <th>Author</th>
    <th>Category</th>
    <th>Book Cover</th>

    {% for item in bk %}
     
        <tr>

        <td>{{ item.book_name }}</td>
        <td>{{ item.Author}}</td>
        <td>{{ item.Category}}</td>
        <td><img src="{{ item.book_cover}}"></td>
        </tr>
        <tr>
          <td>
          <h5>Book Summary:</h5>
            {{ item.book_summary }}
          </td>
        </tr>
        <tr>
          <td>
          <h5>Book Reviews: </h5>
            
          <td>
        </td>  
            <!-- found out iteration in jinja at following site https://newbedev.com/how-to-increment-a-variable-on-a-for-loop-in-jinja-template-->
            {% set count = namespace(value=0) %}
            {% for i in item.review %}
              {{ item._id }}
              {{ item.review[0]}}
            <tr>   <td> <div id="editable{{loop.index}}" > {{ item.review[count.value] }} </div> </td> 
              <td> 
                <div>
                  <div style="float: left"><input type="submit" name="Edit Review" value="Click to Edit" class="btn btn-info"  onclick="editReview({{loop.index}})">
                  </div>
                  <div><input type="submit" name="Submit Changes" value="Submit Changes" class="btn btn-info" onclick="showID({{loop.index}})">
                  </div>
                </div>                   
              </td>
            </tr>
              {% set count.value = count.value + 1 %}
            {% endfor %}
        
        <tr>
        <td> 
          <form action="/write_review" method="post" role="form">
            <input type="hidden" id="bookid" name="bookid" value="{{ item._id }}">
            <input type="submit" name="Write submit" value="Write Review" class="btn btn-info">
          </form>
        </td>
        </tr>
    {% endfor %}

    

  </table>

  

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>   
  <script>
      
      function editReview(counter) {
            alert('HI' + counter)
            var div = document.getElementById('editable'+counter);
            div.onclick = function() {
              this.contentEditable = true;
              this.focus();
              this.style.backgroundColor = '#E0E0E0';
              this.style.border = '1px dotted black';
            }

            //div.onmouseout = function() {
            //    this.style.backgroundColor = '#ffffff';
            //    this.style.border = '';
            //    this.contentEditable = false;
            //}
        
      }
      //function showID(id_num){
      //  alert("The id is " + id_num);
      //}
      function showID(counter){
        //id_num = 3
        var div = document.getElementById('editable'+counter);
        alert(div.innerHTML);
      }
            
   
  </script>
  
{% endblock %}